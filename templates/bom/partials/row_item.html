{# Fila individual de un item del BOM #}
<tr id="item-{{ item.id_item }}"
    class="hover:bg-gray-50 transition-colors {{ 'bg-green-50' if item.entregado else '' }}">
    <td class="px-3 py-2 text-xs text-gray-400 font-mono">{{ loop.index if loop is defined else item.orden }}</td>
    <td class="px-3 py-2">
        {% if item.categoria_nombre %}
        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-700">
            {{ item.categoria_nombre }}
        </span>
        {% else %}
        <span class="text-xs text-gray-400">--</span>
        {% endif %}
    </td>
    <td class="px-3 py-2 text-sm text-gray-800 max-w-xs">
        <div class="truncate" title="{{ item.descripcion }}">{{ item.descripcion }}</div>
        {% if item.comentarios %}
        <div class="text-xs text-gray-400 truncate mt-0.5" title="{{ item.comentarios }}">{{ item.comentarios }}</div>
        {% endif %}
    </td>
    <td class="px-3 py-2 text-sm text-gray-800 text-right font-mono">{{ item.cantidad }}</td>
    <td class="px-3 py-2 text-xs text-gray-600">{{ item.unidad_medida or '--' }}</td>
    <td class="px-3 py-2 text-sm text-gray-800 text-right font-mono">
        {% if item.precio_unitario %}
        ${{ "{:,.2f}".format(item.precio_unitario|float) }}
        {% if item.origen_precio == 'CATALOGO' %}
        <span class="inline-block w-1.5 h-1.5 rounded-full bg-blue-400 ml-0.5" title="Desde catalogo"></span>
        {% endif %}
        {% else %}
        <span class="text-gray-400">--</span>
        {% endif %}
    </td>
    <td class="px-3 py-2 text-sm text-gray-800 text-right font-mono">
        {% if item.importe and item.precio_unitario %}
        ${{ "{:,.2f}".format(item.importe|float) }}
        {% else %}
        <span class="text-gray-400">--</span>
        {% endif %}
    </td>
    <td class="px-3 py-2 text-xs text-gray-600">
        {% if item.fecha_requerida %}
        {% set hoy = none %}
        <span class="{{ 'text-red-600 font-medium' if not item.entregado else 'text-gray-600' }}">
            {{ item.fecha_requerida.strftime('%d/%m/%Y') if item.fecha_requerida else '--' }}
        </span>
        {% else %}
        <span class="text-gray-400">--</span>
        {% endif %}
    </td>
    <td class="px-3 py-2 text-xs text-gray-600">{{ item.proveedor_nombre or '--' }}</td>
    <td class="px-3 py-2 text-xs text-gray-600">
        {% if item.tipo_entrega %}
        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs bg-blue-50 text-blue-700">
            {{ item.tipo_entrega|replace('_', ' ') }}
        </span>
        {% else %}
        <span class="text-gray-400">--</span>
        {% endif %}
    </td>
    <td class="px-3 py-2 text-xs text-gray-600">
        {{ item.fecha_estimada_entrega.strftime('%d/%m/%Y') if item.fecha_estimada_entrega else '--' }}
    </td>
    <td class="px-3 py-2 text-xs text-gray-600">
        {{ item.fecha_llegada_real.strftime('%d/%m/%Y') if item.fecha_llegada_real else '--' }}
    </td>
    <td class="px-3 py-2 text-center">
        {% if item.entregado %}
        <span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-green-100">
            <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
        </span>
        {% else %}
        <span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-gray-100">
            <span class="w-3 h-3 rounded-full bg-gray-300"></span>
        </span>
        {% endif %}
    </td>
    <td class="px-3 py-2 text-center">
        <div class="flex items-center justify-center gap-1">
            {# Boton editar #}
            <button hx-get="/bom/items/{{ item.id_item }}/modal" hx-target="#modal-container" hx-swap="innerHTML"
                class="p-1 rounded hover:bg-gray-200 transition text-gray-500 hover:text-gray-700" title="Editar">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
            </button>
            {# Boton eliminar (solo BORRADOR + ing O en estados de construccion + construccion) #}
            {% if (bom.estatus == 'BORRADOR' and area_editor == 'ingenieria') or (bom.estatus in ['APROBADO_ING',
            'EN_REVISION_CONST'] and area_editor == 'construccion') %}
            <button hx-delete="/bom/items/{{ item.id_item }}" hx-target="#tabla-bom-items" hx-swap="innerHTML"
                hx-confirm="Eliminar este item del BOM?"
                class="p-1 rounded hover:bg-red-100 transition text-gray-400 hover:text-red-600" title="Eliminar">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
            </button>
            {% endif %}
        </div>
    </td>
</tr>