{% set comprobante = comp if comp is defined else comprobante %}
<tr id="row-{{ comprobante.id_comprobante }}" class="hover:bg-gray-50 transition-colors">
    <!-- Checkbox -->
    <td class="px-3 py-3">
        <input type="checkbox" class="row-checkbox rounded border-gray-300 text-[#00BABB] focus:ring-[#00BABB]"
            data-id="{{ comprobante.id_comprobante }}"
            onchange="toggleSelection(this, '{{ comprobante.id_comprobante }}')">
    </td>

    <!-- Fecha -->
    <td class="px-4 py-3 whitespace-nowrap">
        <span class="text-sm font-medium text-gray-900">
            {{ comprobante.fecha_pago.strftime('%d/%m/%Y') if comprobante.fecha_pago else '-' }}
        </span>
    </td>

    <!-- Beneficiario -->
    <td class="px-4 py-3">
        <div class="max-w-[250px]">
            {% if comprobante.proveedor_nombre %}
            <span class="text-sm font-medium text-gray-900">{{ comprobante.proveedor_nombre }}</span>
            <span class="block text-xs text-gray-500">{{ comprobante.proveedor_rfc or '' }}</span>
            {% else %}
            <span class="text-sm text-gray-700">{{ comprobante.beneficiario_orig|truncate(40) }}</span>
            <span class="block text-xs text-orange-500">Sin proveedor asignado</span>
            {% endif %}
        </div>
    </td>

    <!-- Monto -->
    <td class="px-4 py-3 whitespace-nowrap text-right">
        <span
            class="text-sm font-bold {% if comprobante.moneda == 'USD' %}text-green-700{% else %}text-gray-900{% endif %}">
            ${{ "{:,.2f}".format(comprobante.monto) }}
        </span>
        <span class="text-xs ml-1 {% if comprobante.moneda == 'USD' %}text-green-600{% else %}text-gray-500{% endif %}">
            {{ comprobante.moneda }}
        </span>
    </td>

    <!-- Comprador -->
    <td class="px-4 py-3 whitespace-nowrap">
        <span class="text-sm text-gray-600">{{ comprobante.comprador_nombre or '-' }}</span>
    </td>

    <!-- Zona -->
    <td class="px-4 py-3 whitespace-nowrap">
        {% if comprobante.zona_nombre %}
        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
            {{ comprobante.zona_nombre }}
        </span>
        {% else %}
        <span class="text-xs text-gray-400">Sin asignar</span>
        {% endif %}
    </td>

    <!-- CategorÃ­a -->
    <td class="px-4 py-3 whitespace-nowrap">
        {% if comprobante.categoria_nombre %}
        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
            {% if comprobante.categoria_nombre == 'AC' %}bg-purple-100 text-purple-800
            {% elif comprobante.categoria_nombre == 'DC' %}bg-indigo-100 text-indigo-800
            {% else %}bg-gray-100 text-gray-800{% endif %}">
            {{ comprobante.categoria_nombre }}
        </span>
        {% else %}
        <span class="text-xs text-gray-400">Sin asignar</span>
        {% endif %}
    </td>

    <!-- Estatus -->
    <td class="px-4 py-3 whitespace-nowrap">
        {% if comprobante.estatus == 'PENDIENTE' %}
        <span
            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
            <span class="w-2 h-2 mr-1.5 rounded-full bg-yellow-400"></span>
            Pendiente
        </span>
        {% elif comprobante.estatus == 'ANTICIPO' %}
        <span
            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800">
            <span class="w-2 h-2 mr-1.5 rounded-full bg-amber-400"></span>
            Anticipo
        </span>
        {% else %}
        <span
            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
            <span class="w-2 h-2 mr-1.5 rounded-full bg-green-400"></span>
            Facturado
        </span>
        {% endif %}
        {% if comprobante.tipo_factura and comprobante.tipo_factura != 'NORMAL' %}
        <span class="block text-xs text-gray-500 mt-0.5">{{ comprobante.tipo_factura }}</span>
        {% endif %}
    </td>

    <!-- Adjuntos -->
    <td class="px-4 py-3 text-center">
        {% if comprobante.count_archivos and comprobante.count_archivos > 0 %}
        <button hx-get="/compras/comprobante/{{ comprobante.id_comprobante }}/archivos"
            hx-target="#popover-{{ comprobante.id_comprobante }}" hx-swap="innerHTML"
            class="relative text-blue-600 hover:text-blue-800 transition-colors group"
            title="{{ comprobante.count_archivos }} archivo(s)">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" />
            </svg>
            {% if comprobante.count_archivos > 1 %}
            <span
                class="absolute -top-1 -right-1 bg-blue-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center">
                {{ comprobante.count_archivos }}
            </span>
            {% endif %}
        </button>
        <!-- Popover container -->
        <div id="popover-{{ comprobante.id_comprobante }}"
            class="hidden absolute z-10 mt-2 bg-white shadow-lg rounded-lg border border-gray-200"></div>
        {% else %}
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-300" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" />
        </svg>
        {% endif %}
    </td>

    <!-- Acciones -->
    <td class="px-4 py-3 whitespace-nowrap text-center">
        <button onclick="abrirModalEdicion('{{ comprobante.id_comprobante }}')"
            class="text-[#00BABB] hover:text-[#009999] transition-colors" title="Editar">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
        </button>
    </td>
</tr>