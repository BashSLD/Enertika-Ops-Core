{# Template Partial: Lista de Comentarios #}
<div class="space-y-3 custom-scrollbar {{ 'max-h-96 overflow-y-auto' if not mode == 'latest' else '' }}">
    {% if comentarios %}

    {% for comentario in comentarios %}
    <div class="bg-white border border-gray-200 rounded-lg p-3 hover:shadow-sm transition animate-fade-in">
        <div class="flex justify-between items-start mb-1">
            <span class="text-xs font-bold text-[#123456]">{{ comentario.usuario_nombre or comentario.usuario_email
                }}</span>
            <span class="text-[10px] text-gray-500">{{ comentario.fecha_comentario | time_mx }}</span>
        </div>
        {% if comentario.etapa and comentario.etapa != 'Simulacion' %}
        <div class="mb-1">
            <span
                class="inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-medium bg-gray-100 text-gray-600">
                {{ comentario.etapa }}
            </span>
        </div>
        {% endif %}
        <p class="text-xs text-gray-700 whitespace-pre-wrap leading-relaxed">{{ comentario.comentario }}</p>
    </div>
    {% endfor %}

    {% if mode == 'latest' and has_more %}
    <div class="text-center pt-2">
        <button class="text-xs text-blue-600 hover:text-blue-800 underline font-medium focus:outline-none"
            hx-get="/simulacion/partials/comentarios/{{ id_oportunidad }}"
            hx-target="#comentarios-container-{{ id_oportunidad }}" hx-swap="innerHTML">
            Ver historial completo ({{ total_extra }} m√°s)
        </button>
    </div>
    {% elif mode != 'latest' and total_extra > 0 %}
    <div class="text-center pt-2 border-t border-dashed border-gray-200 mt-2">
        <button
            class="text-xs text-gray-400 hover:text-gray-600 underline font-medium focus:outline-none flex items-center justify-center gap-1 w-full"
            hx-get="/simulacion/partials/comentarios/{{ id_oportunidad }}?mode=latest"
            hx-target="#comentarios-container-{{ id_oportunidad }}" hx-swap="innerHTML">
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
            </svg>
            Ocultar historial
        </button>
    </div>
    {% endif %}

    {% else %}
    {% if mode != 'latest' %}
    <div class="text-center py-4 text-gray-400">
        <p class="text-xs italic">No hay comentarios registrados</p>
    </div>
    {% endif %}
    {% endif %}
</div>