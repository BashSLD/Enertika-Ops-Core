{# templates/simulacion/reportes/partials/monthly_pivot.html #}
{# Tabla pivot de resumen mensual #}

<div class="overflow-x-auto">
    <table class="w-full text-sm">
        <thead>
            <tr class="bg-[#123456] text-white">
                <th class="px-4 py-3 text-left font-semibold sticky left-0 bg-[#123456] z-10">Métrica</th>
                {% for mes in meses %}
                <th class="px-4 py-3 text-center font-semibold min-w-[80px]">{{ meses_nombres[mes] }}</th>
                {% endfor %}
                <th class="px-4 py-3 text-center font-semibold bg-[#0d2440] min-w-[100px]">Total</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
            {# Solicitudes Recibidas #}
            <tr class="hover:bg-gray-50">
                <td class="px-4 py-3 font-medium text-gray-900 sticky left-0 bg-white">Solicitudes Recibidas</td>
                {% for mes in meses %}
                <td class="px-4 py-3 text-center">{{ resumen.solicitudes_recibidas.valores.get(mes, 0) }}</td>
                {% endfor %}
                <td class="px-4 py-3 text-center font-bold bg-gray-50">{{ resumen.solicitudes_recibidas.total }}</td>
            </tr>
            
            {# Ofertas Generadas #}
            <tr class="hover:bg-gray-50">
                <td class="px-4 py-3 font-medium text-gray-900 sticky left-0 bg-white">Ofertas Generadas</td>
                {% for mes in meses %}
                <td class="px-4 py-3 text-center">{{ resumen.ofertas_generadas.valores.get(mes, 0) }}</td>
                {% endfor %}
                <td class="px-4 py-3 text-center font-bold bg-gray-50">{{ resumen.ofertas_generadas.total }}</td>
            </tr>
            
            {# % Entregas en Plazo #}
            <tr class="hover:bg-gray-50 bg-green-50/50">
                <td class="px-4 py-3 font-medium text-gray-900 sticky left-0 bg-green-50/50">% Entregas en Plazo</td>
                {% for mes in meses %}
                {% set valor = resumen.porcentaje_en_plazo.valores.get(mes, 0) %}
                <td class="px-4 py-3 text-center {% if valor >= 90 %}text-green-600{% elif valor >= 85 %}text-amber-600{% else %}text-red-600{% endif %} font-semibold">
                    {{ valor }}%
                </td>
                {% endfor %}
                <td class="px-4 py-3 text-center font-bold bg-gray-50 {% if resumen.porcentaje_en_plazo.total >= 90 %}text-green-600{% elif resumen.porcentaje_en_plazo.total >= 85 %}text-amber-600{% else %}text-red-600{% endif %}">
                    {{ resumen.porcentaje_en_plazo.total }}%
                </td>
            </tr>
            
            {# % Entregas Fuera de Plazo #}
            <tr class="hover:bg-gray-50 bg-red-50/50">
                <td class="px-4 py-3 font-medium text-gray-900 sticky left-0 bg-red-50/50">% Entregas Fuera de Plazo</td>
                {% for mes in meses %}
                {% set valor = resumen.porcentaje_fuera_plazo.valores.get(mes, 0) %}
                <td class="px-4 py-3 text-center text-red-600 font-semibold">{{ valor }}%</td>
                {% endfor %}
                <td class="px-4 py-3 text-center font-bold bg-gray-50 text-red-600">{{ resumen.porcentaje_fuera_plazo.total }}%</td>
            </tr>
            
            {# Tiempo Promedio #}
            <tr class="hover:bg-gray-50">
                <td class="px-4 py-3 font-medium text-gray-900 sticky left-0 bg-white">Tiempo Prom. (días)</td>
                {% for mes in meses %}
                <td class="px-4 py-3 text-center">{{ resumen.tiempo_promedio.valores.get(mes, '-') }}</td>
                {% endfor %}
                <td class="px-4 py-3 text-center font-bold bg-gray-50">{{ resumen.tiempo_promedio.total }}</td>
            </tr>
            
            {# En Espera #}
            <tr class="hover:bg-gray-50 bg-amber-50/50">
                <td class="px-4 py-3 font-medium text-gray-900 sticky left-0 bg-amber-50/50">En Espera</td>
                {% for mes in meses %}
                <td class="px-4 py-3 text-center text-amber-600">{{ resumen.en_espera.valores.get(mes, 0) }}</td>
                {% endfor %}
                <td class="px-4 py-3 text-center font-bold bg-gray-50 text-amber-600">{{ resumen.en_espera.total }}</td>
            </tr>
            
            {# Canceladas #}
            <tr class="hover:bg-gray-50">
                <td class="px-4 py-3 font-medium text-gray-900 sticky left-0 bg-white">Canceladas</td>
                {% for mes in meses %}
                <td class="px-4 py-3 text-center">{{ resumen.canceladas.valores.get(mes, 0) }}</td>
                {% endfor %}
                <td class="px-4 py-3 text-center font-bold bg-gray-50">{{ resumen.canceladas.total }}</td>
            </tr>
            
            {# No Viables #}
            <tr class="hover:bg-gray-50">
                <td class="px-4 py-3 font-medium text-gray-900 sticky left-0 bg-white">No Viables</td>
                {% for mes in meses %}
                <td class="px-4 py-3 text-center">{{ resumen.no_viables.valores.get(mes, 0) }}</td>
                {% endfor %}
                <td class="px-4 py-3 text-center font-bold bg-gray-50">{{ resumen.no_viables.total }}</td>
            </tr>
            
            {# Perdidas #}
            <tr class="hover:bg-gray-50 bg-red-50/30">
                <td class="px-4 py-3 font-medium text-gray-900 sticky left-0 bg-red-50/30">Perdidas</td>
                {% for mes in meses %}
                <td class="px-4 py-3 text-center text-red-600">{{ resumen.perdidas.valores.get(mes, 0) }}</td>
                {% endfor %}
                <td class="px-4 py-3 text-center font-bold bg-gray-50 text-red-600">{{ resumen.perdidas.total }}</td>
            </tr>
            
            {# Extraordinarias #}
            <tr class="hover:bg-gray-50 bg-indigo-50/50">
                <td class="px-4 py-3 font-medium text-gray-900 sticky left-0 bg-indigo-50/50">Extraordinarias</td>
                {% for mes in meses %}
                <td class="px-4 py-3 text-center text-indigo-600">{{ resumen.extraordinarias.valores.get(mes, 0) }}</td>
                {% endfor %}
                <td class="px-4 py-3 text-center font-bold bg-gray-50 text-indigo-600">{{ resumen.extraordinarias.total }}</td>
            </tr>
            
            {# Retrabajadas #}
            <tr class="hover:bg-gray-50 bg-cyan-50/50">
                <td class="px-4 py-3 font-medium text-gray-900 sticky left-0 bg-cyan-50/50">Retrabajadas</td>
                {% for mes in meses %}
                <td class="px-4 py-3 text-center text-cyan-600">{{ resumen.retrabajadas.valores.get(mes, 0) }}</td>
                {% endfor %}
                <td class="px-4 py-3 text-center font-bold bg-gray-50 text-cyan-600">{{ resumen.retrabajadas.total }}</td>
            </tr>
        </tbody>
    </table>
</div>

{# Nota informativa #}
<div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
    <div class="flex items-start gap-3">
        <svg class="w-5 h-5 text-blue-500 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <div class="text-sm text-blue-800">
            <p class="font-medium">Nota sobre los porcentajes</p>
            <p class="mt-1 text-blue-700">
                Los porcentajes se calculan sobre las ofertas que tienen KPI asignado (Entregadas + Perdidas).
                Los levantamientos no se incluyen en el cálculo de % de entregas.
            </p>
        </div>
    </div>
</div>
