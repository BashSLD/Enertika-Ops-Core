{# templates/simulacion/reportes/partials/resumen_ejecutivo.html #}
{# Parcial para renderizar el Resumen Ejecutivo Global con datos estructurados #}

<div class="prose max-w-none text-gray-700 leading-relaxed text-sm">
    <p>
        En el per√≠odo del <strong>{{ resumen.fecha_inicio_formatted }}</strong> al <strong>{{
            resumen.fecha_fin_formatted }}</strong>
        se recibieron <strong>{{ resumen.total_solicitudes }} solicitudes</strong>
        {% if resumen.top_tipos %}
        , de las cuales
        {% for tipo in resumen.top_tipos %}
        {{ tipo.nombre }} ({{ tipo.total }} - {{ tipo.porcentaje }}%){% if not loop.last %}, {% endif %}
        {% endfor %}
        {% endif %}.
    </p>

    <p class="mt-4">
        Se obtuvo un <strong>cumplimiento interno del {{ resumen.porcentaje_cumplimiento_interno }}%</strong>
        ({{ resumen.entregas_a_tiempo_interno }} entregas a tiempo de {{ resumen.total_entregas_interno }} totales)
        y un <strong>cumplimiento con cliente del {{ resumen.porcentaje_cumplimiento_compromiso }}%</strong>
        ({{ resumen.entregas_a_tiempo_compromiso }} entregas a tiempo de {{ resumen.total_entregas_compromiso }}
        totales).
    </p>

    {# REMOVED: Mejor usuario block as per user request #}

    <p class="mt-4">
        De las {{ resumen.total_solicitudes }} solicitudes,
        <strong>{{ resumen.licitaciones }} fueron licitaciones</strong> ({{ resumen.porcentaje_licitaciones }}%),
        <strong>{{ resumen.extraordinarias }} extraordinarias</strong> ({{ resumen.porcentaje_extraordinarias }}%),
        y <strong>{{ resumen.versiones }} actualizaciones</strong> de proyectos existentes ({{
        resumen.porcentaje_versiones }}%).
    </p>

    {# Bloque de Retrabajos #}
    {% if resumen.total_retrabajos > 0 %}
    <p class="text-gray-700 leading-relaxed mt-4">
        <strong class="text-orange-700">{{ resumen.total_retrabajos }} solicitudes
            ({{ resumen.porcentaje_retrabajos }}%) tuvieron que retrabajarse</strong>
        {% if resumen.motivo_retrabajo_principal %}
        , siendo la causa principal
        <strong class="text-red-700">"{{ resumen.motivo_retrabajo_principal }}"</strong>
        ({{ resumen.conteo_motivo_principal }} casos).
        {% else %}
        .
        {% endif %}
    </p>
    {% endif %}
</div>

{# ============================================ #}
{# SECCI√ìN: DESEMPE√ëO POR PERFIL #}
{# ============================================ #}
{% if resumen.categorias_usuarios %}
<div class="mt-8 border-t-2 border-gray-200 pt-6">
    <h3 class="text-xl font-bold text-gray-900 mb-4">
        Desempe√±o por Perfil de Impacto
    </h3>
    <p class="text-sm text-gray-600 mb-6">
        {# (Categorizaci√≥n seg√∫n naturaleza del trabajo para an√°lisis justo) - REMOVED #}
    </p>

    {# Alta Complejidad #}
    {% if resumen.categorias_usuarios.alta_complejidad %}
    <div class="mb-6">
        <h4 class="text-lg font-bold text-amber-700">
            üèÜ L√≠deres de Alta Complejidad
        </h4>

        {% for usuario in resumen.categorias_usuarios.alta_complejidad %}
        <div class="ml-4 mb-4 p-4 bg-amber-50 rounded-lg border-l-4 border-amber-500">
            <div class="font-semibold text-gray-900 mb-2">
                ‚Ä¢ {{ usuario.nombre }}:
                <span class="text-amber-700">
                    Score {{ "%.1f"|format(usuario.score.score_final * 100) }}/100
                </span>
                <span class="text-sm text-gray-600">(ponderado por complejidad)</span>
            </div>

            <div class="ml-4 text-sm text-gray-700 space-y-1">
                <div class="flex items-start">
                    <span class="w-4 mr-2">‚îú‚îÄ</span>
                    <span>
                        Entregas: <strong>{{ usuario.total_ofertas }}</strong>
                        ({{ usuario.licitaciones }} licitaciones,
                        {{ "%.1f"|format((usuario.licitaciones / usuario.total_ofertas) * 100) }}%)
                    </span>
                </div>
                <div class="flex items-start">
                    <span class="w-4 mr-2">‚îú‚îÄ</span>
                    <span>
                        Cumplimiento: <strong>{{ usuario.porcentaje_a_tiempo_compromiso }}%</strong> compromiso cliente,
                        <strong>{{ usuario.porcentaje_a_tiempo_interno }}%</strong> SLA interno
                    </span>
                </div>
                <div class="flex items-start">
                    <span class="w-4 mr-2">‚îî‚îÄ</span>
                    <span>
                        Retrabajos: <strong>{{ usuario.retrabajados }}</strong>
                        ({{ "%.1f"|format((usuario.retrabajados / usuario.total_ofertas) * 100) }}%)
                        {% if usuario.score.motivo_retrabajo_principal %}
                        - Principal: "{{ usuario.score.motivo_retrabajo_principal }}"
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {# Eficiencia #}
    {% if resumen.categorias_usuarios.eficiencia %}
    <div class="mb-6">
        <h4 class="text-lg font-bold text-blue-700">
            ‚ö° L√≠deres de Eficiencia
        </h4>

        {% for usuario in resumen.categorias_usuarios.eficiencia %}
        <div class="ml-4 mb-4 p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
            <div class="font-semibold text-gray-900 mb-2">
                ‚Ä¢ {{ usuario.nombre }}:
                <span class="text-blue-700">
                    Score {{ "%.1f"|format(usuario.score.score_final * 100) }}/100
                </span>
            </div>

            <div class="ml-4 text-sm text-gray-700 space-y-1">
                <div class="flex items-start">
                    <span class="w-4 mr-2">‚îú‚îÄ</span>
                    <span>
                        Entregas: <strong>{{ usuario.total_ofertas }}</strong>
                        ({{ usuario.licitaciones }} licitaciones,
                        {{ "%.1f"|format((usuario.licitaciones / usuario.total_ofertas) * 100) }}%)
                    </span>
                </div>
                <div class="flex items-start">
                    <span class="w-4 mr-2">‚îú‚îÄ</span>
                    <span>
                        Cumplimiento: <strong>{{ usuario.porcentaje_a_tiempo_compromiso }}%</strong> compromiso cliente,
                        <strong>{{ usuario.porcentaje_a_tiempo_interno }}%</strong> SLA interno
                    </span>
                </div>
                <div class="flex items-start">
                    <span class="w-4 mr-2">‚îî‚îÄ</span>
                    <span>
                        Retrabajos: <strong>{{ usuario.retrabajados }}</strong>
                        ({{ "%.1f"|format((usuario.retrabajados / usuario.total_ofertas) * 100) }}%)
                        {% if usuario.score.motivo_retrabajo_principal %}
                        - Principal: "{{ usuario.score.motivo_retrabajo_principal }}"
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>
        {% endfor %}

        {# Nota explicativa - SOLO si hay Alta Complejidad #}
        {% if resumen.mostrar_nota_alta_complejidad %}
        <div class="mt-4 p-4 bg-amber-50 rounded-lg border-l-4 border-amber-400">
            <p class="text-sm text-amber-900">
                <strong>‚ÑπÔ∏è Nota sobre "Alta Complejidad":</strong><br>
                Esta categor√≠a reconoce usuarios que trabajan proyectos estrat√©gicos
                (licitaciones ‚â•{{ "%.0f"|format(resumen.umbral_licitaciones_pct) }}%, el doble del promedio global de
                <strong>{{ "%.1f"|format(resumen.ratio_licitaciones_global) }}%</strong>).
                Estos proyectos requieren mayor tiempo de elaboraci√≥n y tienen
                requisitos formales m√°s estrictos.
            </p>
        </div>
        {% endif %}
    </div>
    {% endif %}

    {# En Evaluaci√≥n #}
    {% if resumen.categorias_usuarios.evaluacion %}
    <div class="mb-6">
        <h4 class="text-lg font-bold text-gray-600">
            üìä Otros Colaboradores
        </h4>

        {% for usuario in resumen.categorias_usuarios.evaluacion %}
        <div class="ml-4 mb-3 text-sm text-gray-700">
            ‚Ä¢ <strong>{{ usuario.nombre }}</strong>:
            {{ usuario.total_ofertas }} entrega{% if usuario.total_ofertas != 1 %}s{% endif %} completada{% if
            usuario.total_ofertas != 1 %}s{% endif %}
            ({{ usuario.porcentaje_a_tiempo_compromiso }}% cumplimiento)
        </div>
        {% endfor %}

        <p class="ml-4 text-xs text-gray-500 italic mt-2">
            Nota: Se requieren al menos 10 entregas para c√°lculo de score de desempe√±o.
        </p>
    </div>
    {% endif %}

</div>
{% endif %}